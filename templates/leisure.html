<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cota√ß√µes Lazer | R3 Viagens</title>
    <link
      rel="icon"
      href="{{ url_for('static', filename='assets/icone.png') }}"
      type="image/png"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Saira:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <meta
      http-equiv="Cache-Control"
      content="no-store, no-cache, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Saira", sans-serif;
      }

      body {
        background: #f5f6fa;
      }

      /* ==========================
       SIDEBAR ‚Äì FIGMA
    ========================== */
      .sidebar {
        width: 288px;
        height: 100vh;
        background: #00245a;
        padding: 32px 24px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 24px;
        position: fixed;
        top: 0;
        left: 0;
      }

      .sidebar-logo img {
        width: 90px;
        height: 90px;
      }

      .sidebar-menu {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      /* ==========================
       DROPDOWN (COTA√á√ïES)
    ========================== */
      .dropdown {
        width: 100%;
        background: #ab1e22;
        border-radius: 8px;
        padding: 12px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .dropdown-header {
        display: flex;
        align-items: center;
        gap: 8px;
        position: relative;
        color: #ffffff;
      }

      .dropdown-header-left {
        flex: 1;
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .dropdown-icon {
        width: 24px;
        height: 24px;
      }

      .dropdown-arrow {
        width: 20px;
        height: 20px;
        position: absolute;
        right: 5px;
        top: 40%;
        transform: translateY(-40%);
        transition: transform 0.2s ease;
      }

      .dropdown.open .dropdown-arrow {
        transform: rotate(180deg);
      }

      .submenu {
        display: none;
        flex-direction: column;
        gap: 8px;
        margin-left: 4px;
        margin-top: 4px;
      }

      .dropdown.open .submenu {
        display: flex;
      }

      .submenu-item {
        padding: 12px;
        border-radius: 6px;
        font-size: 14px;
        color: white;
        cursor: pointer;
        transition: background 0.2s;
      }

      .submenu-item:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      /* ==========================
       MENU ITEM NORMAL
    ========================== */
      .menu-item {
        width: 100%;
        padding: 12px;
        border-radius: 6px;
        color: white;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background 0.2s;
      }

      .menu-item:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      /* ==========================
       TOPBAR SUPERIOR
    ========================== */
      .topbar {
        position: fixed;
        top: 0;
        left: 288px;
        width: calc(100% - 288px);
        height: 70px;
        background: #ffffff;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding: 0 40px;
        gap: 24px;
        border-bottom: 1px solid #e5e5e5;
        z-index: 50;
      }

      .topbar-user {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .topbar-user span {
        font-size: 16px;
        color: #333;
        font-weight: 500;
      }

      .topbar-avatar {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #ddd;
      }

      .topbar-logout {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 15px;
        color: #555;
        cursor: pointer;
        text-decoration: none;
        transition: 0.2s;
      }

      .topbar-logout:hover {
        color: #ab1e22;
      }

      .topbar-logout svg {
        width: 20px;
        height: 20px;
      }

      .topbar-divider {
        width: 1px;
        height: 40px;
        background: #ccd3e0;
        margin: 0 18px;
      }

      /* ==========================
       MAIN CONTENT
    ========================== */
      .home-container {
        margin-left: 288px;
        padding: 120px 40px 40px 40px; /* espa√ßo para a topbar */
      }

      .tag {
        background-color: #ab1e22;
        color: white;
        font-size: 13px;
        padding: 6px 12px;
        border-radius: 30px;
        font-weight: 500;
      }

      .submenu-item {
        text-decoration: none; /* Remove o underline */
      }

      .dropdown-option {
        padding: 10px 16px;
        cursor: pointer;
        color: #4d5568;
        border-bottom: 1px solid #eee;
      }

      .dropdown-option:hover {
        background-color: #f5f5f5;
      }

      .tag-cotacao {
        background-color: #ab1e22;
        color: white;
        padding: 6px 12px;
        border-radius: 30px;
        font-size: 13px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .tag-cotacao span {
        cursor: pointer;
        font-weight: bold;
      }

      .campo-bloqueado {
        border: 1.5px dashed #ab1e22 !important;
        background-color: #f1bbbb !important;
      }

      .borda-vermelha {
        border: 2px solid #ab1e22 !important;
        background-color: #f8cbcb !important;
      }

      .mensagem-bloqueio {
        font-size: 13px;
        color: #ab1e22;
        margin-top: 4px;
        font-weight: 500;
      }
    </style>
  </head>

  <body>
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <img
          src="{{ url_for('static', filename='assets/logo_r3.png') }}"
          alt="Logo R3"
        />
      </div>

      <nav class="sidebar-menu">
        {% if menu.cotacoes %}
        <div class="dropdown" onclick="toggleDropdown()">
          <div class="dropdown-header">
            <div class="dropdown-header-left">
              <div class="dropdown-icon">
                <!-- √çcone de Cota√ß√µes -->
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                >
                  <path
                    d="M12 6.75V8.25"
                    stroke="white"
                    stroke-width="1.5"
                    stroke-linecap="round"
                  />
                  <path
                    d="M12 15.75V17.25"
                    stroke="white"
                    stroke-width="1.5"
                    stroke-linecap="round"
                  />
                  <path
                    d="M12 21c4.97 0 9-4.03 9-9s-4.03-9-9-9-9 4.03-9 9 4.03 9 9 9z"
                    stroke="white"
                    stroke-width="1.5"
                  />
                  <path
                    d="M9.75 15.75h3.375c.497 0 .974-.197 1.325-.549.352-.351.55-.828.55-1.326 0-.498-.198-.975-.55-1.326-.351-.352-.828-.549-1.325-.549h-2.25c-.497 0-.974-.198-1.325-.55A1.87 1.87 0 0 1 9 10.125c0-.498.198-.975.55-1.326.351-.352.828-.549 1.325-.549h3.375"
                    stroke="white"
                    stroke-width="1.5"
                  />
                </svg>
              </div>
              Cota√ß√µes
            </div>
            <div class="dropdown-arrow">
              <svg width="15" height="10" fill="none">
                <path d="M1 1l4 4 4-4" stroke="white" stroke-width="1.5" />
              </svg>
            </div>
          </div>

          <div class="submenu">
            <a class="submenu-item" href="{{ url_for('cotacoes_lazer') }}"
              >Lazer</a
            >

            <a class="submenu-item" href="{{ url_for('cotacoes_corporativo') }}"
              >Corporativo</a
            >
          </div>
        </div>
        {% endif %} {% if menu.relatorios %}
        <a class="menu-item" href="{{ url_for('relatorios') }}">
          <div class="menu-icon">
            <!-- √çcone de relat√≥rios -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="none"
            >
              <path
                d="M9 12h6M9 15h6"
                stroke="white"
                stroke-width="1.5"
                stroke-linecap="round"
              />
              <path
                d="M4.5 3.75h15V18.75a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 18.75V3.75z"
                stroke="white"
                stroke-width="1.5"
              />
              <path
                d="M7.5 2.25v3M12 2.25v3M16.5 2.25v3"
                stroke="white"
                stroke-width="1.5"
              />
            </svg>
          </div>
          Relat√≥rios
        </a>
        {% endif %} {% if menu.usuarios %}
        <a class="menu-item" href="{{ url_for('usuarios') }}">
          <div class="menu-icon">
            <!-- √çcone de Usu√°rios -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="none"
            >
              <path
                d="M7.875 15A4.875 4.875 0 1 0 7.875 5.25a4.875 4.875 0 0 0 0 9.75z"
                stroke="white"
                stroke-width="1.5"
              />
              <path
                d="M1 18.75c1.5-2.25 4.5-3.75 6.875-3.75 2.375 0 5.375 1.5 6.875 3.75"
                stroke="white"
                stroke-width="1.5"
              />
              <path
                d="M16.125 15c2.25 0 4.875 1.5 6.375 3.75"
                stroke="white"
                stroke-width="1.5"
              />
              <path
                d="M14.5 5.5a5.5 5.5 0 0 1 5 9"
                stroke="white"
                stroke-width="1.5"
              />
            </svg>
          </div>
          Usu√°rios
        </a>
        {% endif %}
      </nav>
    </aside>

    <!-- ==============================
         TOPBAR SUPERIOR
    ============================== -->
    <header class="topbar">
      <div class="topbar-user">
        <span>Bem-vinda, {{ session['user'] }}!</span>

        <!-- Avatar tempor√°rio -->
        <a href="{{ url_for('perfil') }}" class="topbar-avatar-link">
          <img
            src="{{ url_for('static', filename=profile_pic) }}"
            class="topbar-avatar"
            alt="Foto do usu√°rio"
          />
        </a>

        <!-- BARRINHA DIVIS√ìRIA -->
        <div class="topbar-divider"></div>
      </div>

      <a href="{{ url_for('logout') }}" class="topbar-logout">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
        >
          <g clip-path="url(#clip0_3_163)">
            <path
              d="M10.5 3.75H4.5V20.25H10.5"
              stroke="#969696"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M10.5 12H21"
              stroke="#969696"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M17.25 8.25L21 12L17.25 15.75"
              stroke="#969696"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </g>
          <defs>
            <clipPath id="clip0_3_163">
              <rect width="24" height="24" fill="white" />
            </clipPath>
          </defs>
        </svg>
        Sair
      </a>
    </header>

    <!-- ==============================
         CONTE√öDO DA HOME
    ============================== -->
    <div class="home-container">
      <!-- Breadcrumb -->
      <p style="font-size: 14px; color: #777; margin-bottom: 4px">
        Cota√ß√µes > Lazer
      </p>

      <!-- T√≠tulo da p√°gina -->
      <h1
        style="
          font-size: 24px;
          font-weight: 700;
          color: #1c1c1c;
          margin-bottom: 32px;
        "
      >
        Cota√ß√µes Lazer
      </h1>

      <form action="/send-email-lazer" method="POST" enctype="multipart/form-data"
        style="
          background: #fff;
          padding: 32px;
          border-radius: 12px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 28px 40px;
          align-items: start;
        "
      >
        <!-- Nome do Cliente -->
        <div style="display: flex; flex-direction: column; gap: 6px">
          <label style="font-weight: 600">Nome do cliente *</label>
          <input
          id="nome_cliente" name="nome_cliente"
            type="text"
            placeholder="Nome do cliente"
            style="
              padding: 12px;
              border: 1.5px solid #ab1e22;
              border-radius: 8px;
              background: #f0f0f0;
            "
            required
          />
        </div>

        <!-- E-mail -->
        <div style="display: flex; flex-direction: column; gap: 6px">
          <label style="font-weight: 600">E-mail do Cliente *</label>
          <input
            name="email_cliente"
            type="email"
            placeholder="E-mail do Cliente"
            style="
              padding: 12px;
              border: 1.5px solid #ab1e22;
              border-radius: 8px;
              background: #f0f0f0;
            "
            required
          />
        </div>

        <!-- Cota√ß√µes -->
        <div
          style="
            grid-column: span 2;
            display: flex;
            flex-direction: column;
            gap: 6px;
          "
        >
          <label style="font-weight: 600">Selecione as cota√ß√µes *</label>

          <div id="cotacoes-dropdown" style="position: relative">
            <div
              onclick="toggleDropdownCOTACOES()"
              style="
                background: #f0f0f0;
                border: 1.5px solid #ab1e22;
                border-radius: 8px;
                padding: 12px;
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <span style="color: #4d5568">Clique para selecionar</span>
              <svg width="20" height="20">
                <path d="M6 9L12 15L18 9" stroke="#4D5568" stroke-width="2" />
              </svg>
            </div>

            <div
              id="opcoes-cotacoes"
              style="
                display: none;
                position: absolute;
                width: 100%;
                background: #fff;
                border: 1px solid #ccc;
                border-radius: 8px;
                margin-top: 4px;
                z-index: 99;
              "
            >
              <div class="dropdown-option" onclick="selecionarOpcao('A√©reo')">
                A√©reo
              </div>
              <div class="dropdown-option" onclick="selecionarOpcao('Hotel')">
                Hotel
              </div>
              <div class="dropdown-option" onclick="selecionarOpcao('Loca√ß√£o')">
                Loca√ß√£o
              </div>
              <div
                class="dropdown-option"
                onclick="selecionarOpcao('Seguro Viagem')"
              >
                Seguro Viagem
              </div>
              <div
                class="dropdown-option"
                onclick="selecionarOpcao('Passeios')"
              >
                Passeios
              </div>
              <div
                class="dropdown-option"
                onclick="selecionarOpcao('Transfers')"
              >
                Transfers
              </div>
              <div class="dropdown-option" onclick="selecionarOpcao('Trens')">
                Trens
              </div>
              <div class="dropdown-option" onclick="selecionarOpcao('Outros')">
                Outros
              </div>
            </div>
          </div>

          <div
            id="tags-cotacoes"
            style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap"
          ></div>
          <input
            type="hidden"
            id="cotacoesSelecionadas"
            name="cotacoesSelecionadas"
          />
        </div>

        <!-- Upload -->
        <div style="display: flex; flex-direction: column; gap: 6px">
          <label style="font-weight: 600">Arquivo da Cota√ß√£o </label>

          <div
            style="
              width: 100%;
              height: 130px;
              border: 1.5px dashed #ab1e22;
              border-radius: 8px;
              background: #f0f0f0;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              gap: 6px;
            "
          >
            <p style="margin: 0; color: #4d5568">Drag and drop files here</p>
            <p style="margin: 0; font-size: 12px; color: #777">
              Limit 200MB per file ‚Ä¢ PDF, DOCX, XLSX, XLS
            </p>

            <label
              style="
                padding: 6px 14px;
                background: #d9d9d9;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 600;
                color: #333;
              "
            >
              Browse files
              <input
                type="file"
                id="arquivo"
                name="arquivo"
                accept=".pdf,.doc,.docx,.xlsx,.xls"
                style="display: none"
              />
            </label>
          </div>
        </div>

        <!-- Tipo de viagem -->
        <div style="display: flex; flex-direction: column; gap: 6px">
          <label style="font-weight: 600">Tipo de viagem: *</label>
          <div style="display: flex; gap: 28px">
            <label
              ><input type="radio" name="tipo_viagem" required /> Internacional</label
            >
            <label><input type="radio" name="tipo_viagem" required /> Nacional</label>
          </div>
        </div>

        <!-- Textarea -->
        <div
          style="
            grid-column: span 2;
            display: flex;
            flex-direction: column;
            gap: 6px;
          "
        >
          <label for="texto_cotacao" style="font-weight: 600"
            >Cole aqui a cota√ß√£o em texto
          </label>
          <textarea
            id="texto_cotacao"
            name="texto_cotacao"
            rows="10"
            placeholder="Cole aqui a cota√ß√£o..."
            style="
              width: 100%;
              padding: 12px;
              border: 1.5px solid #ab1e22;
              border-radius: 8px;
              background: #f0f0f0;
              color: #4d5568;
            "
          ></textarea>
        </div>

        <!-- Bot√µes -->
        <div
          style="
            grid-column: span 2;
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            margin-top: 5px;
          "
        >
          <button
            id="btnReprocessar"
            type="button"
            style="
              background: #ab1e22;
              color: white;
              border: none;
              padding: 12px 36px;
              border-radius: 40px;
              font-weight: 600;
              font-size: 15px;
              cursor: pointer;
              transition: 0.2s;
            "
          >
            Reprocessar
          </button>

          <button
            type="reset"
            style="
              background: #ab1e22;
              color: white;
              border: none;
              padding: 12px 36px;
              border-radius: 40px;
              font-weight: 600;
              font-size: 15px;
              cursor: pointer;
              transition: 0.2s;
            "
          >
            Limpar
          </button>
        </div>
      </form>
    </div>

    <!-- MODAL DE PR√â-VISUALIZA√á√ÉO -->
    <div
      id="modalPreview"
      style="
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 999;
        align-items: center;
        justify-content: center;
      "
    >
      <div
        style="
          background: white;
          width: 90%;
          max-width: 700px;
          border-radius: 12px;
          padding: 24px;
          display: flex;
          flex-direction: column;
          gap: 16px;
        "
      >
        <h2 style="font-size: 20px">Pr√©-visualiza√ß√£o do E-mail</h2>

        <div
          id="previewEmail"
          style="
            background: #f5f5f5;
            padding: 16px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 14px;
          "
        ></div>

        <!-- LINHA FINAL COM MENSAGEM + BOT√ïES -->
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-top: 10px;
          "
        >
          <!-- MENSAGEM DE STATUS -->
          <span id="mensagemModal" style="font-weight: 600"></span>

          <!-- BOT√ïES -->
          <div style="display: flex; gap: 12px">
            <button
              onclick="fecharModal()"
              style="
                padding: 10px 24px;
                border-radius: 30px;
                border: none;
                background: #777;
                color: white;
                cursor: pointer;
              "
            >
              Fechar
            </button>

            <button
              id="btnEnviarModal"
              style="
                padding: 10px 24px;
                border-radius: 30px;
                border: none;
                background: #ab1e22;
                color: white;
                font-weight: 600;
                cursor: pointer;
              "
            >
              Enviar E-mail
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      function toggleDropdown() {
        document.querySelector(".dropdown").classList.toggle("open");
      }
    </script>

    <script>
      history.pushState(null, "", location.href);
      window.onpopstate = function () {
        history.pushState(null, "", location.href);
      };
    </script>

    <script>
      //cotacoes
      let selecionadas = [];

      function toggleDropdownCOTACOES() {
        const menu = document.getElementById("opcoes-cotacoes");
        menu.style.display =
          menu.style.display === "none" || menu.style.display === ""
            ? "block"
            : "none";
      }

      function selecionarOpcao(valor) {
        if (!selecionadas.includes(valor)) {
          selecionadas.push(valor);
          atualizarTags();
        }

        // Fecha o dropdown ap√≥s a sele√ß√£o
        document.getElementById("opcoes-cotacoes").style.display = "none";
      }

      function removerTag(valor) {
        selecionadas = selecionadas.filter((item) => item !== valor);
        atualizarTags();
      }

      function atualizarTags() {
        const container = document.getElementById("tags-cotacoes");
        container.innerHTML = "";
        selecionadas.forEach((valor) => {
          const tag = document.createElement("div");
          tag.className = "tag-cotacao";
          tag.innerHTML = `${valor} <span onclick="removerTag('${valor}')">√ó</span>`;
          container.appendChild(tag);
        });

        document.getElementById("cotacoesSelecionadas").value =
          selecionadas.join(",");
      }

      // Fechar dropdown ao clicar fora
      document.addEventListener("click", function (e) {
        const dropdown = document.getElementById("cotacoes-dropdown");
        if (!dropdown.contains(e.target)) {
          document.getElementById("opcoes-cotacoes").style.display = "none";
        }
      });
    </script>

    <!-- Script para bloquear um campo se o outro for usado -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.getElementById("arquivo");
        const textArea = document.getElementById("texto_cotacao");

        // Desativa texto se o arquivo for carregado
        fileInput.addEventListener("change", function () {
          if (fileInput.files.length > 0) {
            textArea.disabled = true;
          } else {
            textArea.disabled = false;
          }
        });

        // Desativa upload se o textarea estiver preenchido
        textArea.addEventListener("input", function () {
          if (textArea.value.trim() !== "") {
            fileInput.disabled = true;
          } else {
            fileInput.disabled = false;
          }
        });
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.getElementById("arquivo");
        const textArea = document.getElementById("texto_cotacao");
        const uploadBox = fileInput.closest("div[style*='dashed']");

        // Cria as mensagens (mas ainda invis√≠veis)
        const msgTexto = document.createElement("div");
        msgTexto.classList.add("mensagem-bloqueio");
        msgTexto.textContent =
          "Como voc√™ escolheu enviar um arquivo, o campo de texto foi desativado.";
        msgTexto.style.display = "none";
        textArea.parentNode.appendChild(msgTexto);

        const msgUpload = document.createElement("div");
        msgUpload.classList.add("mensagem-bloqueio");
        msgUpload.textContent =
          "Como voc√™ colou o texto manualmente, o envio de arquivo foi desativado.";
        msgUpload.style.display = "none";
        uploadBox.parentNode.appendChild(msgUpload);

        // === UPLOAD de arquivo ===
        fileInput.addEventListener("change", function () {
          if (fileInput.files.length > 0) {
            textArea.disabled = true;
            textArea.classList.add("borda-vermelha");
            msgTexto.style.display = "block";

            uploadBox.classList.remove("borda-vermelha");
            msgUpload.style.display = "none";
          } else {
            textArea.disabled = false;
            textArea.classList.remove("borda-vermelha");
            msgTexto.style.display = "none";
          }
        });

        // === TEXTO manual ===
        textArea.addEventListener("input", function () {
          if (textArea.value.trim() !== "") {
            fileInput.disabled = true;
            uploadBox.classList.add("borda-vermelha");
            msgUpload.style.display = "block";

            msgTexto.style.display = "none";
          } else {
            fileInput.disabled = false;
            uploadBox.classList.remove("borda-vermelha");
            msgUpload.style.display = "none";
          }
        });
      });
    </script>

    <script>
  document.addEventListener("DOMContentLoaded", function () {
    const btnReprocessar = document.getElementById("btnReprocessar");
    const btnEnviarModal = document.getElementById("btnEnviarModal");
    const mensagemModal = document.getElementById("mensagemModal");
    const modal = document.getElementById("modalPreview");
    const preview = document.getElementById("previewEmail");
    const form = document.querySelector("form");

    if (btnReprocessar && modal && preview && form) {
      btnReprocessar.addEventListener("click", function () {
        const dados = new FormData(form);

        btnReprocessar.disabled = true;
        btnReprocessar.innerText = "Reprocessando...";

        preview.textContent = "Carregando pr√©-visualiza√ß√£o...";

        fetch("/preview-email-lazer", {
          method: "POST",
          body: dados,
        })
          .then((response) => response.text())
          .then((texto) => {
            preview.textContent = texto;
            modal.style.display = "flex";

            btnReprocessar.disabled = false;
            btnReprocessar.innerText = "Reprocessar";
          })
          .catch(() => {
            preview.textContent = "Erro ao gerar pr√©-visualiza√ß√£o.";
            modal.style.display = "flex";

            btnReprocessar.disabled = false;
            btnReprocessar.innerText = "Reprocessar";
          });
      });
    }

    if (btnEnviarModal && mensagemModal && form) {
      btnEnviarModal.addEventListener("click", function () {
        const dados = new FormData(form);

        btnEnviarModal.disabled = true;
        btnEnviarModal.textContent = "Enviando...";

        mensagemModal.style.color = "#444";
        mensagemModal.textContent =
          "üì® E-mail enviado com sucesso. Aguarde um momento e n√£o feche a janela ainda.";

        fetch("/send-email-lazer", {
          method: "POST",
          body: dados,
        })
          .then((response) => {
            if (!response.ok) throw new Error();
            return response.json();
          })
          .then(() => {
            mensagemModal.style.color = "green";
            mensagemModal.textContent =
              "‚úÖ Processo conclu√≠do. A janela pode ser fechada.";
          })
          .catch(() => {
            mensagemModal.style.color = "red";
            mensagemModal.textContent =
              "‚ùå Erro ao enviar o e-mail. Tente novamente.";
            btnEnviarModal.disabled = false;
            btnEnviarModal.textContent = "Enviar E-mail";
          });
      });
    }
  });

  function fecharModal() {
    const modal = document.getElementById("modalPreview");
    modal.style.display = "none";

    const mensagemModal = document.getElementById("mensagemModal");
    if (mensagemModal) {
      mensagemModal.textContent = "";
      mensagemModal.style.color = "";
    }
  }
</script>
  </body>
</html>
